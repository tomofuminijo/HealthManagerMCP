# 実装計画: ユーザー管理機能への生年月日追加

## 概要

既存のHealthmate-HealthManagerサービスのユーザー管理MCPツール（AddUser、UpdateUser、GetUser）に生年月日（dateOfBirth）フィールドを追加する実装アプローチです。

## タスク

- [x] 1. MCPスキーマファイルの更新
  - `mcp-schema/user-management-mcp-schema.json`にdateOfBirthフィールドを追加
  - AddUser、UpdateUser、GetUserツールのスキーマを更新
  - YYYY-MM-DD形式のパターン検証を追加
  - _要件: 4.1, 4.2, 4.3, 4.4_

- [ ]* 1.1 MCPスキーマ更新のプロパティテスト
  - **プロパティ1: 有効な生年月日の保存と取得**
  - **検証対象: 要件1.1、2.1、3.1、3.3**

- [x] 2. 日付検証関数の実装
  - `lambda/user/handler.py`にvalidate_date_of_birth関数を追加
  - YYYY-MM-DD形式の検証
  - 過去の日付であることの確認
  - 1900年以降の日付制限
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [ ]* 2.1 日付検証のプロパティテスト
  - **プロパティ3: 日付検証の一貫性**
  - **検証対象: 要件1.3、1.4、2.4、5.1、5.2、5.3、5.4**

- [x] 3. add_user関数の更新
  - dateOfBirthパラメータの処理を追加
  - 生年月日の検証呼び出し
  - DynamoDBアイテムへの条件付き追加
  - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ]* 3.1 add_user関数のプロパティテスト
  - **プロパティ2: 生年月日なしでのユーザー操作**
  - **検証対象: 要件1.2、3.2**

- [x] 4. update_user関数の更新
  - dateOfBirthパラメータの処理を追加
  - 空文字列での削除処理
  - 部分更新での他フィールド保持
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ]* 4.1 update_user関数のプロパティテスト（更新）
  - **プロパティ4: 生年月日の更新と置き換え**
  - **検証対象: 要件2.2**

- [ ]* 4.2 update_user関数のプロパティテスト（削除）
  - **プロパティ5: 生年月日フィールドの削除**
  - **検証対象: 要件2.3**

- [ ]* 4.3 update_user関数のプロパティテスト（部分更新）
  - **プロパティ6: 部分更新での他フィールド保持**
  - **検証対象: 要件6.3**

- [x] 5. get_user関数の更新
  - レスポンスにdateOfBirthフィールドを追加
  - 存在しない場合のnull処理
  - 後方互換性の維持
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [ ]* 5.1 get_user関数のプロパティテスト
  - **プロパティ7: 後方互換性の維持**
  - **検証対象: 要件6.1、6.2、6.4**

- [x] 6. チェックポイント - 全テストの実行
  - 全てのテストが通ることを確認し、質問があれば用户に確認する

- [ ]* 7. 統合テストの実装
  - MCP経由でのE2Eテスト
  - 既存ユーザーデータでの後方互換性テスト
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [ ] 8. 最終チェックポイント - 全テストの実行
  - 全てのテストが通ることを確認し、質問があれば用户に確認する

## 注意事項

- `*`マークのタスクはオプションで、より迅速なMVPのためにスキップ可能
- 各タスクは特定の要件への追跡可能性を持つ
- チェックポイントで段階的な検証を実施
- プロパティテストは普遍的な正当性プロパティを検証
- 単体テストは具体的な例とエッジケースを検証