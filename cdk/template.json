{
  "Description": "Healthspan100 - AI Personal Trainer for 100-year Healthspan",
  "Resources": {
    "UsersTable9725E9C8": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "userId",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "userId",
            "KeyType": "HASH"
          }
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true
        },
        "TableName": "healthspan100-users"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UsersTable/Resource"
      }
    },
    "PoliciesTableB128A423": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "userId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "policyId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "policyType",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "policyType-index",
            "KeySchema": [
              {
                "AttributeName": "policyType",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "userId",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "policyId",
            "KeyType": "RANGE"
          }
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true
        },
        "TableName": "healthspan100-policies"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/PoliciesTable/Resource"
      }
    },
    "ActivitiesTable7C8DBFD8": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "userId",
            "AttributeType": "S"
          },
          {
            "AttributeName": "date",
            "AttributeType": "S"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "date-index",
            "KeySchema": [
              {
                "AttributeName": "date",
                "KeyType": "HASH"
              }
            ],
            "Projection": {
              "ProjectionType": "ALL"
            }
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "userId",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "date",
            "KeyType": "RANGE"
          }
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true
        },
        "TableName": "healthspan100-activities"
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/ActivitiesTable/Resource"
      }
    },
    "UserPool6BA7E5F2": {
      "Type": "AWS::Cognito::UserPool",
      "Properties": {
        "AccountRecoverySetting": {
          "RecoveryMechanisms": [
            {
              "Name": "verified_email",
              "Priority": 1
            }
          ]
        },
        "AdminCreateUserConfig": {
          "AllowAdminCreateUserOnly": false
        },
        "AliasAttributes": [
          "email"
        ],
        "AutoVerifiedAttributes": [
          "email"
        ],
        "EmailVerificationMessage": "The verification code to your new account is {####}",
        "EmailVerificationSubject": "Verify your new account",
        "Policies": {
          "PasswordPolicy": {
            "MinimumLength": 8,
            "RequireLowercase": true,
            "RequireNumbers": true,
            "RequireSymbols": false,
            "RequireUppercase": true
          }
        },
        "SmsVerificationMessage": "The verification code to your new account is {####}",
        "UserPoolName": "healthspan100-users",
        "VerificationMessageTemplate": {
          "DefaultEmailOption": "CONFIRM_WITH_CODE",
          "EmailMessage": "The verification code to your new account is {####}",
          "EmailSubject": "Verify your new account",
          "SmsMessage": "The verification code to your new account is {####}"
        }
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UserPool/Resource"
      }
    },
    "UserPoolChatGPTClient70678701": {
      "Type": "AWS::Cognito::UserPoolClient",
      "Properties": {
        "AccessTokenValidity": 60,
        "AllowedOAuthFlows": [
          "code"
        ],
        "AllowedOAuthFlowsUserPoolClient": true,
        "AllowedOAuthScopes": [
          "openid",
          "profile",
          "email",
          "phone"
        ],
        "CallbackURLs": [
          "https://chatgpt.com/connector_platform_oauth_redirect"
        ],
        "ClientName": "healthspan100-chatgpt-client",
        "ExplicitAuthFlows": [
          "ALLOW_USER_PASSWORD_AUTH",
          "ALLOW_USER_SRP_AUTH",
          "ALLOW_CUSTOM_AUTH",
          "ALLOW_USER_AUTH",
          "ALLOW_REFRESH_TOKEN_AUTH"
        ],
        "GenerateSecret": true,
        "IdTokenValidity": 60,
        "LogoutURLs": [
          "https://chatgpt.com/connector_platform_oauth_redirect"
        ],
        "RefreshTokenValidity": 43200,
        "SupportedIdentityProviders": [
          "COGNITO"
        ],
        "TokenValidityUnits": {
          "AccessToken": "minutes",
          "IdToken": "minutes",
          "RefreshToken": "minutes"
        },
        "UserPoolId": {
          "Ref": "UserPool6BA7E5F2"
        }
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UserPool/ChatGPTClient/Resource"
      }
    },
    "UserPoolUserPoolDomain9F01E991": {
      "Type": "AWS::Cognito::UserPoolDomain",
      "Properties": {
        "Domain": "healthspan100",
        "UserPoolId": {
          "Ref": "UserPool6BA7E5F2"
        }
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UserPool/UserPoolDomain/Resource"
      }
    },
    "UserLambdaLogGroup621A63DF": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/healthspan100-user",
        "RetentionInDays": 7
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UserLambdaLogGroup/Resource"
      }
    },
    "UserLambdaServiceRole0C79BFF0": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UserLambda/ServiceRole/Resource"
      }
    },
    "UserLambdaServiceRoleDefaultPolicy30940387": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:ConditionCheckItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
                "dynamodb:GetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:PutItem",
                "dynamodb:Query",
                "dynamodb:Scan",
                "dynamodb:UpdateItem"
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "UsersTable9725E9C8",
                  "Arn"
                ]
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "UserLambdaServiceRoleDefaultPolicy30940387",
        "Roles": [
          {
            "Ref": "UserLambdaServiceRole0C79BFF0"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UserLambda/ServiceRole/DefaultPolicy/Resource"
      }
    },
    "UserLambdaAD4FB23B": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-212643943530-ap-northeast-1",
          "S3Key": "424c431676506656d5290c6fee41ecc158488c72cbed644dc78dc7ca544f2f7e.zip"
        },
        "Environment": {
          "Variables": {
            "USERS_TABLE_NAME": {
              "Ref": "UsersTable9725E9C8"
            }
          }
        },
        "FunctionName": "healthspan100-user",
        "Handler": "user.handler.lambda_handler",
        "LoggingConfig": {
          "LogGroup": {
            "Ref": "UserLambdaLogGroup621A63DF"
          }
        },
        "MemorySize": 256,
        "Role": {
          "Fn::GetAtt": [
            "UserLambdaServiceRole0C79BFF0",
            "Arn"
          ]
        },
        "Runtime": "python3.12",
        "Timeout": 30
      },
      "DependsOn": [
        "UserLambdaServiceRoleDefaultPolicy30940387",
        "UserLambdaServiceRole0C79BFF0"
      ],
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UserLambda/Resource",
        "aws:asset:path": "asset.424c431676506656d5290c6fee41ecc158488c72cbed644dc78dc7ca544f2f7e",
        "aws:asset:is-bundled": false,
        "aws:asset:property": "Code"
      }
    },
    "UserLambdaAllowBedrockInvoke1507DB83": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "UserLambdaAD4FB23B",
            "Arn"
          ]
        },
        "Principal": "bedrock.amazonaws.com"
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UserLambda/AllowBedrockInvoke"
      }
    },
    "HealthPolicyLambdaLogGroup5F6DC2FB": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/healthspan100-health-policy",
        "RetentionInDays": 7
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/HealthPolicyLambdaLogGroup/Resource"
      }
    },
    "HealthPolicyLambdaServiceRole104AD184": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/HealthPolicyLambda/ServiceRole/Resource"
      }
    },
    "HealthPolicyLambdaServiceRoleDefaultPolicyABA94B50": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:ConditionCheckItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
                "dynamodb:GetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:PutItem",
                "dynamodb:Query",
                "dynamodb:Scan",
                "dynamodb:UpdateItem"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "PoliciesTableB128A423",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "PoliciesTableB128A423",
                          "Arn"
                        ]
                      },
                      "/index/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "HealthPolicyLambdaServiceRoleDefaultPolicyABA94B50",
        "Roles": [
          {
            "Ref": "HealthPolicyLambdaServiceRole104AD184"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/HealthPolicyLambda/ServiceRole/DefaultPolicy/Resource"
      }
    },
    "HealthPolicyLambdaEA28E85E": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-212643943530-ap-northeast-1",
          "S3Key": "424c431676506656d5290c6fee41ecc158488c72cbed644dc78dc7ca544f2f7e.zip"
        },
        "Environment": {
          "Variables": {
            "POLICIES_TABLE_NAME": {
              "Ref": "PoliciesTableB128A423"
            }
          }
        },
        "FunctionName": "healthspan100-health-policy",
        "Handler": "health_policy.handler.lambda_handler",
        "LoggingConfig": {
          "LogGroup": {
            "Ref": "HealthPolicyLambdaLogGroup5F6DC2FB"
          }
        },
        "MemorySize": 256,
        "Role": {
          "Fn::GetAtt": [
            "HealthPolicyLambdaServiceRole104AD184",
            "Arn"
          ]
        },
        "Runtime": "python3.12",
        "Timeout": 30
      },
      "DependsOn": [
        "HealthPolicyLambdaServiceRoleDefaultPolicyABA94B50",
        "HealthPolicyLambdaServiceRole104AD184"
      ],
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/HealthPolicyLambda/Resource",
        "aws:asset:path": "asset.424c431676506656d5290c6fee41ecc158488c72cbed644dc78dc7ca544f2f7e",
        "aws:asset:is-bundled": false,
        "aws:asset:property": "Code"
      }
    },
    "HealthPolicyLambdaAllowBedrockInvokeB1F80E09": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "HealthPolicyLambdaEA28E85E",
            "Arn"
          ]
        },
        "Principal": "bedrock.amazonaws.com"
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/HealthPolicyLambda/AllowBedrockInvoke"
      }
    },
    "ActivityLambdaLogGroup25C1C4FA": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/healthspan100-activity",
        "RetentionInDays": 7
      },
      "UpdateReplacePolicy": "Delete",
      "DeletionPolicy": "Delete",
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/ActivityLambdaLogGroup/Resource"
      }
    },
    "ActivityLambdaServiceRole54ACCB8D": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition"
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
              ]
            ]
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/ActivityLambda/ServiceRole/Resource"
      }
    },
    "ActivityLambdaServiceRoleDefaultPolicy3F4FFB29": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:BatchGetItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:ConditionCheckItem",
                "dynamodb:DeleteItem",
                "dynamodb:DescribeTable",
                "dynamodb:GetItem",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
                "dynamodb:PutItem",
                "dynamodb:Query",
                "dynamodb:Scan",
                "dynamodb:UpdateItem"
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ActivitiesTable7C8DBFD8",
                    "Arn"
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "ActivitiesTable7C8DBFD8",
                          "Arn"
                        ]
                      },
                      "/index/*"
                    ]
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "ActivityLambdaServiceRoleDefaultPolicy3F4FFB29",
        "Roles": [
          {
            "Ref": "ActivityLambdaServiceRole54ACCB8D"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/ActivityLambda/ServiceRole/DefaultPolicy/Resource"
      }
    },
    "ActivityLambdaF78DB3C0": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-212643943530-ap-northeast-1",
          "S3Key": "424c431676506656d5290c6fee41ecc158488c72cbed644dc78dc7ca544f2f7e.zip"
        },
        "Environment": {
          "Variables": {
            "ACTIVITIES_TABLE_NAME": {
              "Ref": "ActivitiesTable7C8DBFD8"
            }
          }
        },
        "FunctionName": "healthspan100-activity",
        "Handler": "activity.handler.lambda_handler",
        "LoggingConfig": {
          "LogGroup": {
            "Ref": "ActivityLambdaLogGroup25C1C4FA"
          }
        },
        "MemorySize": 256,
        "Role": {
          "Fn::GetAtt": [
            "ActivityLambdaServiceRole54ACCB8D",
            "Arn"
          ]
        },
        "Runtime": "python3.12",
        "Timeout": 30
      },
      "DependsOn": [
        "ActivityLambdaServiceRoleDefaultPolicy3F4FFB29",
        "ActivityLambdaServiceRole54ACCB8D"
      ],
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/ActivityLambda/Resource",
        "aws:asset:path": "asset.424c431676506656d5290c6fee41ecc158488c72cbed644dc78dc7ca544f2f7e",
        "aws:asset:is-bundled": false,
        "aws:asset:property": "Code"
      }
    },
    "ActivityLambdaAllowBedrockInvokeADFD938E": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "ActivityLambdaF78DB3C0",
            "Arn"
          ]
        },
        "Principal": "bedrock.amazonaws.com"
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/ActivityLambda/AllowBedrockInvoke"
      }
    },
    "BedrockAgentRole7C982E0C": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "bedrock.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Description": "IAM role for Healthspan100 Bedrock Agent"
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/BedrockAgentRole/Resource"
      }
    },
    "BedrockAgentRoleDefaultPolicy1462CD5B": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "bedrock:InvokeModel",
              "Effect": "Allow",
              "Resource": "arn:aws:bedrock:ap-northeast-1::foundation-model/anthropic.claude-3-5-sonnet-20240620-v1:0"
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "BedrockAgentRoleDefaultPolicy1462CD5B",
        "Roles": [
          {
            "Ref": "BedrockAgentRole7C982E0C"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/BedrockAgentRole/DefaultPolicy/Resource"
      }
    },
    "HealthspanAgent": {
      "Type": "AWS::Bedrock::Agent",
      "Properties": {
        "ActionGroups": [
          {
            "ActionGroupExecutor": {
              "Lambda": {
                "Fn::GetAtt": [
                  "UserLambdaAD4FB23B",
                  "Arn"
                ]
              }
            },
            "ActionGroupName": "UserManagement",
            "ApiSchema": {
              "Payload": "{\"openapi\": \"3.0.0\", \"info\": {\"title\": \"UserManagement API\", \"version\": \"1.0.0\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fc\\u60c5\\u5831\\u7ba1\\u7406API\"}, \"paths\": {\"/addUser\": {\"post\": {\"description\": \"\\u65b0\\u3057\\u3044\\u30e6\\u30fc\\u30b6\\u30fc\\u60c5\\u5831\\u3092\\u4f5c\\u6210\\u3059\\u308b\", \"operationId\": \"AddUser\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\\uff08Cognito User ID\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"username\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fc\\u540d\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"email\", \"in\": \"query\", \"description\": \"\\u30e1\\u30fc\\u30eb\\u30a2\\u30c9\\u30ec\\u30b9\", \"required\": false, \"schema\": {\"type\": \"string\"}}, {\"name\": \"goals\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fc\\u306e\\u76ee\\u6a19\\uff08\\u8907\\u6570\\u53ef\\uff09\\u3002\\u4f8b\\uff1a\\u300c\\u76f4\\u8fd11\\u5e74\\u306710kg\\u30c0\\u30a4\\u30a8\\u30c3\\u30c8\\u300d\\u300c100\\u6b73\\u307e\\u3067\\u5065\\u5eb7\\u5bff\\u547d\\u300d\", \"required\": false, \"schema\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"message\": {\"type\": \"string\"}, \"userId\": {\"type\": \"string\"}}}}}}}}}, \"/updateUser\": {\"post\": {\"description\": \"\\u30e6\\u30fc\\u30b6\\u30fc\\u60c5\\u5831\\u3092\\u66f4\\u65b0\\u3059\\u308b\", \"operationId\": \"UpdateUser\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"username\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fc\\u540d\", \"required\": false, \"schema\": {\"type\": \"string\"}}, {\"name\": \"email\", \"in\": \"query\", \"description\": \"\\u30e1\\u30fc\\u30eb\\u30a2\\u30c9\\u30ec\\u30b9\", \"required\": false, \"schema\": {\"type\": \"string\"}}, {\"name\": \"goals\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fc\\u306e\\u76ee\\u6a19\\uff08\\u8907\\u6570\\u53ef\\uff09\\u3002\\u4f8b\\uff1a\\u300c\\u76f4\\u8fd11\\u5e74\\u306710kg\\u30c0\\u30a4\\u30a8\\u30c3\\u30c8\\u300d\\u300c100\\u6b73\\u307e\\u3067\\u5065\\u5eb7\\u5bff\\u547d\\u300d\", \"required\": false, \"schema\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}}}, {\"name\": \"lastLoginAt\", \"in\": \"query\", \"description\": \"\\u6700\\u7d42\\u30ed\\u30b0\\u30a4\\u30f3\\u65e5\\u6642\", \"required\": false, \"schema\": {\"type\": \"string\"}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"message\": {\"type\": \"string\"}}}}}}}}}, \"/getUser\": {\"post\": {\"description\": \"\\u30e6\\u30fc\\u30b6\\u30fc\\u60c5\\u5831\\u3092\\u53d6\\u5f97\\u3059\\u308b\", \"operationId\": \"GetUser\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"user\": {\"type\": \"object\", \"properties\": {\"userId\": {\"type\": \"string\"}, \"username\": {\"type\": \"string\"}, \"email\": {\"type\": \"string\"}, \"goals\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}}, \"createdAt\": {\"type\": \"string\"}, \"lastLoginAt\": {\"type\": \"string\"}}}, \"message\": {\"type\": \"string\"}}}}}}}}}}}"
            },
            "Description": "ユーザー情報の管理（プロフィール、設定など）"
          },
          {
            "ActionGroupExecutor": {
              "Lambda": {
                "Fn::GetAtt": [
                  "HealthPolicyLambdaEA28E85E",
                  "Arn"
                ]
              }
            },
            "ActionGroupName": "HealthPolicyManagement",
            "ApiSchema": {
              "Payload": "{\"openapi\": \"3.0.0\", \"info\": {\"title\": \"HealthPolicyManagement API\", \"version\": \"1.0.0\", \"description\": \"\\u5065\\u5eb7\\u30dd\\u30ea\\u30b7\\u30fc\\u7ba1\\u7406API\"}, \"paths\": {\"/addPolicy\": {\"post\": {\"description\": \"\\u65b0\\u3057\\u3044\\u5065\\u5eb7\\u30dd\\u30ea\\u30b7\\u30fc\\u3092\\u8ffd\\u52a0\\u3059\\u308b\", \"operationId\": \"AddPolicy\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"policyType\", \"in\": \"query\", \"description\": \"\\u30dd\\u30ea\\u30b7\\u30fc\\u30bf\\u30a4\\u30d7\\uff08diet|exercise|sleep|fasting|other\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"description\", \"in\": \"query\", \"description\": \"\\u30dd\\u30ea\\u30b7\\u30fc\\u306e\\u8aac\\u660e\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"parameters\", \"in\": \"query\", \"description\": \"\\u30dd\\u30ea\\u30b7\\u30fc\\u56fa\\u6709\\u306e\\u30d1\\u30e9\\u30e1\\u30fc\\u30bf\\uff08JSON\\u5f62\\u5f0f\\uff09\", \"required\": false, \"schema\": {\"type\": \"object\"}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"message\": {\"type\": \"string\"}, \"policyId\": {\"type\": \"string\"}}}}}}}}}, \"/updatePolicy\": {\"post\": {\"description\": \"\\u65e2\\u5b58\\u306e\\u5065\\u5eb7\\u30dd\\u30ea\\u30b7\\u30fc\\u3092\\u66f4\\u65b0\\u3059\\u308b\", \"operationId\": \"UpdatePolicy\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"policyId\", \"in\": \"query\", \"description\": \"\\u30dd\\u30ea\\u30b7\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"description\", \"in\": \"query\", \"description\": \"\\u30dd\\u30ea\\u30b7\\u30fc\\u306e\\u8aac\\u660e\", \"required\": false, \"schema\": {\"type\": \"string\"}}, {\"name\": \"parameters\", \"in\": \"query\", \"description\": \"\\u30dd\\u30ea\\u30b7\\u30fc\\u56fa\\u6709\\u306e\\u30d1\\u30e9\\u30e1\\u30fc\\u30bf\\uff08JSON\\u5f62\\u5f0f\\uff09\", \"required\": false, \"schema\": {\"type\": \"object\"}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"message\": {\"type\": \"string\"}}}}}}}}}, \"/deletePolicy\": {\"post\": {\"description\": \"\\u6307\\u5b9a\\u3057\\u305f\\u5065\\u5eb7\\u30dd\\u30ea\\u30b7\\u30fc\\u3092\\u524a\\u9664\\u3059\\u308b\", \"operationId\": \"DeletePolicy\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"policyId\", \"in\": \"query\", \"description\": \"\\u30dd\\u30ea\\u30b7\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"message\": {\"type\": \"string\"}}}}}}}}}, \"/getPolicy\": {\"post\": {\"description\": \"\\u30e6\\u30fc\\u30b6\\u30fc\\u306e\\u3059\\u3079\\u3066\\u306e\\u5065\\u5eb7\\u30dd\\u30ea\\u30b7\\u30fc\\u3092\\u53d6\\u5f97\\u3059\\u308b\", \"operationId\": \"GetPolicy\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"policies\": {\"type\": \"array\", \"items\": {\"type\": \"object\", \"properties\": {\"policyId\": {\"type\": \"string\"}, \"policyType\": {\"type\": \"string\"}, \"description\": {\"type\": \"string\"}, \"parameters\": {\"type\": \"object\"}, \"createdAt\": {\"type\": \"string\"}, \"updatedAt\": {\"type\": \"string\"}}}}, \"count\": {\"type\": \"integer\"}}}}}}}}}}}"
            },
            "Description": "ユーザーの健康ポリシー（食事制限、運動習慣など）を管理する"
          },
          {
            "ActionGroupExecutor": {
              "Lambda": {
                "Fn::GetAtt": [
                  "ActivityLambdaF78DB3C0",
                  "Arn"
                ]
              }
            },
            "ActionGroupName": "ActivityManagement",
            "ApiSchema": {
              "Payload": "{\"openapi\": \"3.0.0\", \"info\": {\"title\": \"ActivityManagement API\", \"version\": \"1.0.0\", \"description\": \"\\u6d3b\\u52d5\\u8a18\\u9332\\u7ba1\\u7406API\"}, \"paths\": {\"/addActivity\": {\"post\": {\"description\": \"\\u6307\\u5b9a\\u3057\\u305f\\u65e5\\u306e\\u30e6\\u30fc\\u30b6\\u30fc\\u306e\\u884c\\u52d5\\u3092\\u8ffd\\u52a0\\u3059\\u308b\", \"operationId\": \"AddActivity\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"date\", \"in\": \"query\", \"description\": \"\\u65e5\\u4ed8\\uff08YYYY-MM-DD\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"time\", \"in\": \"query\", \"description\": \"\\u6642\\u523b\\uff08HH:MM\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"activityType\", \"in\": \"query\", \"description\": \"\\u6d3b\\u52d5\\u30bf\\u30a4\\u30d7\\uff08wakeUp|sleep|exercise|meal|snack|weight|bodyFat|mood|medication|other\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"description\", \"in\": \"query\", \"description\": \"\\u6d3b\\u52d5\\u306e\\u8aac\\u660e\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"items\", \"in\": \"query\", \"description\": \"\\u6d3b\\u52d5\\u306e\\u8a73\\u7d30\\u9805\\u76ee\", \"required\": false, \"schema\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"message\": {\"type\": \"string\"}}}}}}}}}, \"/updateActivity\": {\"post\": {\"description\": \"\\u6307\\u5b9a\\u3057\\u305f\\u65e5\\u306e\\u6307\\u5b9a\\u3057\\u305f\\u884c\\u52d5\\u3092\\u66f4\\u65b0\\u3059\\u308b\", \"operationId\": \"UpdateActivity\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"date\", \"in\": \"query\", \"description\": \"\\u65e5\\u4ed8\\uff08YYYY-MM-DD\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"time\", \"in\": \"query\", \"description\": \"\\u6642\\u523b\\uff08HH:MM\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"activityType\", \"in\": \"query\", \"description\": \"\\u6d3b\\u52d5\\u30bf\\u30a4\\u30d7\", \"required\": false, \"schema\": {\"type\": \"string\"}}, {\"name\": \"description\", \"in\": \"query\", \"description\": \"\\u6d3b\\u52d5\\u306e\\u8aac\\u660e\", \"required\": false, \"schema\": {\"type\": \"string\"}}, {\"name\": \"items\", \"in\": \"query\", \"description\": \"\\u6d3b\\u52d5\\u306e\\u8a73\\u7d30\\u9805\\u76ee\", \"required\": false, \"schema\": {\"type\": \"array\", \"items\": {\"type\": \"string\"}}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"message\": {\"type\": \"string\"}}}}}}}}}, \"/deleteActivity\": {\"post\": {\"description\": \"\\u6307\\u5b9a\\u3057\\u305f\\u65e5\\u306e\\u6307\\u5b9a\\u3057\\u305f\\u884c\\u52d5\\u3092\\u524a\\u9664\\u3059\\u308b\", \"operationId\": \"DeleteActivity\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"date\", \"in\": \"query\", \"description\": \"\\u65e5\\u4ed8\\uff08YYYY-MM-DD\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"time\", \"in\": \"query\", \"description\": \"\\u6642\\u523b\\uff08HH:MM\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"message\": {\"type\": \"string\"}}}}}}}}}, \"/getActivities\": {\"post\": {\"description\": \"\\u6307\\u5b9a\\u3057\\u305f\\u65e5\\u306e\\u30e6\\u30fc\\u30b6\\u30fc\\u306e\\u884c\\u52d5\\u3092\\u53d6\\u5f97\\u3059\\u308b\", \"operationId\": \"GetActivities\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"date\", \"in\": \"query\", \"description\": \"\\u65e5\\u4ed8\\uff08YYYY-MM-DD\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"date\": {\"type\": \"string\"}, \"activities\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}}, \"count\": {\"type\": \"integer\"}}}}}}}}}, \"/getActivitiesInRange\": {\"post\": {\"description\": \"\\u6307\\u5b9a\\u3057\\u305f\\u671f\\u9593\\u306e\\u30e6\\u30fc\\u30b6\\u30fc\\u306e\\u884c\\u52d5\\u5c65\\u6b74\\u3092\\u53d6\\u5f97\\u3059\\u308b\\uff08\\u6700\\u5927365\\u65e5\\u9593\\uff09\", \"operationId\": \"GetActivitiesInRange\", \"parameters\": [{\"name\": \"userId\", \"in\": \"query\", \"description\": \"\\u30e6\\u30fc\\u30b6\\u30fcID\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"startDate\", \"in\": \"query\", \"description\": \"\\u958b\\u59cb\\u65e5\\uff08YYYY-MM-DD\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}, {\"name\": \"endDate\", \"in\": \"query\", \"description\": \"\\u7d42\\u4e86\\u65e5\\uff08YYYY-MM-DD\\uff09\", \"required\": true, \"schema\": {\"type\": \"string\"}}], \"responses\": {\"200\": {\"description\": \"\\u6210\\u529f\", \"content\": {\"application/json\": {\"schema\": {\"type\": \"object\", \"properties\": {\"success\": {\"type\": \"boolean\"}, \"startDate\": {\"type\": \"string\"}, \"endDate\": {\"type\": \"string\"}, \"dailyActivities\": {\"type\": \"array\", \"items\": {\"type\": \"object\", \"properties\": {\"date\": {\"type\": \"string\"}, \"activities\": {\"type\": \"array\", \"items\": {\"type\": \"object\"}}}}}, \"totalDays\": {\"type\": \"integer\"}}}}}}}}}}}"
            },
            "Description": "ユーザーの日々の健康活動を記録・取得する"
          }
        ],
        "AgentName": "healthspan100-ai-trainer",
        "AgentResourceRoleArn": {
          "Fn::GetAtt": [
            "BedrockAgentRole7C982E0C",
            "Arn"
          ]
        },
        "Description": "100年健康寿命のための健康情報記録エージェント - データ記録・取得専用",
        "FoundationModel": "anthropic.claude-3-5-sonnet-20240620-v1:0",
        "IdleSessionTTLInSeconds": 1800,
        "Instruction": "あなたはユーザーの健康情報を記録・管理する専属の記録エージェントです。\n\nあなたの役割:\nあなたはユーザー専用の健康情報記録システムです。外部AIシステム（ChatGPTなど）からの指示に従い、ユーザーの健康ポリシーと活動履歴を淡々と記録・取得します。\n\n管理するデータ:\n- ユーザーの健康ポリシー（食事制限、運動習慣、睡眠パターンなど）\n- 日々の活動記録（体重、食事、運動、気分など）\n\nあなたの責任:\n\n1. データ取得:\n   - 健康ポリシーの取得依頼 → GetPolicyアクションを実行し、データをそのまま返す\n   - 活動履歴の取得依頼 → GetActivitiesまたはGetActivitiesInRangeアクションを実行し、データをそのまま返す\n   - 期間指定の取得依頼（例：「過去1週間」「先月」「過去1年間」）→ GetActivitiesInRangeを適切な日付範囲（最大365日）で実行\n   - データベースから取得したデータを加工せず、そのまま提供する\n\n2. データ登録:\n   - 健康ポリシーの登録依頼 → AddPolicyアクションを実行\n   - 活動の記録依頼 → AddActivityアクションを実行\n   - データの更新依頼 → UpdatePolicyまたはUpdateActivityアクションを実行\n   - 登録・更新の結果を簡潔に報告する\n\n3. 現在日付の扱い:\n   - 本日の日付: $currentDate$\n   - 日付が指定されていない場合は、この日付を使用する\n\n4. ユーザーID管理:\n   - userIdはセッション属性から自動的に取得される\n   - すべての操作でセッション属性のuserIdを使用する\n\n重要な制約:\n- フィードバックやアドバイスは一切提供しない\n- データの解釈や評価は行わない\n- 健康に関する意見や提案は述べない\n- データの記録と取得のみに専念する\n- 取得したデータは加工せず、そのまま提供する\n\n応答の原則:\n- 簡潔で事務的な応答を心がける\n- 感情的な表現は使用しない\n- データの記録・取得結果を淡々と報告する\n- 余計なコメントは付け加えない\n",
        "MemoryConfiguration": {
          "EnabledMemoryTypes": [
            "SESSION_SUMMARY"
          ],
          "SessionSummaryConfiguration": {
            "MaxRecentSessions": 10
          },
          "StorageDays": 30
        }
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/HealthspanAgent"
      }
    },
    "AgentCoreGatewayRoleB10592CC": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "bedrock.amazonaws.com"
              }
            }
          ],
          "Version": "2012-10-17"
        },
        "Description": "IAM role for AgentCore Gateway to invoke Lambda functions"
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/AgentCoreGatewayRole/Resource"
      }
    },
    "AgentCoreGatewayRoleDefaultPolicy0A71016B": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "lambda:InvokeFunction",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "ActivityLambdaF78DB3C0",
                    "Arn"
                  ]
                },
                {
                  "Fn::GetAtt": [
                    "HealthPolicyLambdaEA28E85E",
                    "Arn"
                  ]
                },
                {
                  "Fn::GetAtt": [
                    "UserLambdaAD4FB23B",
                    "Arn"
                  ]
                }
              ]
            }
          ],
          "Version": "2012-10-17"
        },
        "PolicyName": "AgentCoreGatewayRoleDefaultPolicy0A71016B",
        "Roles": [
          {
            "Ref": "AgentCoreGatewayRoleB10592CC"
          }
        ]
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/AgentCoreGatewayRole/DefaultPolicy/Resource"
      }
    },
    "AgentCoreGateway": {
      "Type": "AWS::BedrockAgentCore::Gateway",
      "Properties": {
        "Name": "healthspan100-gateway",
        "Description": "healthspan100 MCP Gateway for ChatGPT integration",
        "ProtocolType": "MCP",
        "RoleArn": {
          "Fn::GetAtt": [
            "AgentCoreGatewayRoleB10592CC",
            "Arn"
          ]
        },
        "AuthorizerType": "CUSTOM_JWT",
        "AuthorizerConfiguration": {
          "CustomJWTAuthorizer": {
            "DiscoveryUrl": {
              "Fn::Join": [
                "",
                [
                  "https://cognito-idp.ap-northeast-1.amazonaws.com/",
                  {
                    "Ref": "UserPool6BA7E5F2"
                  },
                  "/.well-known/openid-configuration"
                ]
              ]
            },
            "AllowedClients": [
              {
                "Ref": "UserPoolChatGPTClient70678701"
              }
            ]
          }
        }
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/AgentCoreGateway"
      }
    },
    "UserManagementGatewayTarget": {
      "Type": "AWS::BedrockAgentCore::GatewayTarget",
      "Properties": {
        "Name": "UserManagement",
        "Description": "ユーザー情報を管理する",
        "GatewayIdentifier": {
          "Ref": "AgentCoreGateway"
        },
        "CredentialProviderConfigurations": [
          {
            "CredentialProviderType": "GATEWAY_IAM_ROLE"
          }
        ],
        "TargetConfiguration": {
          "Mcp": {
            "Lambda": {
              "LambdaArn": {
                "Fn::GetAtt": [
                  "UserLambdaAD4FB23B",
                  "Arn"
                ]
              },
              "ToolSchema": {
                "InlinePayload": [
                  {
                    "name": "AddUser",
                    "description": "新しいユーザー情報を作成する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID（Cognito User ID）"
                        },
                        "username": {
                          "type": "string",
                          "description": "ユーザー名"
                        },
                        "email": {
                          "type": "string",
                          "description": "メールアドレス"
                        },
                        "goals": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "ユーザーの目標（複数可）。例：「直近1年で10kgダイエット」「100歳まで健康寿命」"
                        }
                      },
                      "required": [
                        "userId",
                        "username"
                      ]
                    }
                  },
                  {
                    "name": "UpdateUser",
                    "description": "ユーザー情報を更新する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        },
                        "username": {
                          "type": "string",
                          "description": "ユーザー名"
                        },
                        "email": {
                          "type": "string",
                          "description": "メールアドレス"
                        },
                        "goals": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "ユーザーの目標（複数可）。例：「直近1年で10kgダイエット」「100歳まで健康寿命」"
                        },
                        "lastLoginAt": {
                          "type": "string",
                          "description": "最終ログイン日時"
                        }
                      },
                      "required": [
                        "userId"
                      ]
                    }
                  },
                  {
                    "name": "GetUser",
                    "description": "ユーザー情報を取得する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        }
                      },
                      "required": [
                        "userId"
                      ]
                    }
                  }
                ]
              }
            }
          }
        }
      },
      "DependsOn": [
        "AgentCoreGateway"
      ],
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/UserManagementGatewayTarget"
      }
    },
    "HealthPolicyManagementGatewayTarget": {
      "Type": "AWS::BedrockAgentCore::GatewayTarget",
      "Properties": {
        "Name": "HealthPolicyManagement",
        "Description": "ユーザーの健康ポリシーを管理する",
        "GatewayIdentifier": {
          "Ref": "AgentCoreGateway"
        },
        "CredentialProviderConfigurations": [
          {
            "CredentialProviderType": "GATEWAY_IAM_ROLE"
          }
        ],
        "TargetConfiguration": {
          "Mcp": {
            "Lambda": {
              "LambdaArn": {
                "Fn::GetAtt": [
                  "HealthPolicyLambdaEA28E85E",
                  "Arn"
                ]
              },
              "ToolSchema": {
                "InlinePayload": [
                  {
                    "name": "AddPolicy",
                    "description": "新しい健康ポリシーを追加する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        },
                        "policyType": {
                          "type": "string",
                          "description": "ポリシータイプ（diet|exercise|sleep|fasting|other）"
                        },
                        "description": {
                          "type": "string",
                          "description": "ポリシーの説明"
                        },
                        "parameters": {
                          "type": "object",
                          "description": "ポリシー固有のパラメータ"
                        }
                      },
                      "required": [
                        "userId",
                        "policyType",
                        "description"
                      ]
                    }
                  },
                  {
                    "name": "UpdatePolicy",
                    "description": "既存の健康ポリシーを更新する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        },
                        "policyId": {
                          "type": "string",
                          "description": "ポリシーID"
                        },
                        "description": {
                          "type": "string",
                          "description": "ポリシーの説明"
                        },
                        "parameters": {
                          "type": "object",
                          "description": "ポリシー固有のパラメータ"
                        }
                      },
                      "required": [
                        "userId",
                        "policyId"
                      ]
                    }
                  },
                  {
                    "name": "DeletePolicy",
                    "description": "指定した健康ポリシーを削除する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        },
                        "policyId": {
                          "type": "string",
                          "description": "ポリシーID"
                        }
                      },
                      "required": [
                        "userId",
                        "policyId"
                      ]
                    }
                  },
                  {
                    "name": "GetPolicy",
                    "description": "ユーザーのすべての健康ポリシーを取得する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        }
                      },
                      "required": [
                        "userId"
                      ]
                    }
                  }
                ]
              }
            }
          }
        }
      },
      "DependsOn": [
        "AgentCoreGateway"
      ],
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/HealthPolicyManagementGatewayTarget"
      }
    },
    "ActivityManagementGatewayTarget": {
      "Type": "AWS::BedrockAgentCore::GatewayTarget",
      "Properties": {
        "Name": "ActivityManagement",
        "Description": "ユーザーの日々の健康活動を記録・取得する",
        "GatewayIdentifier": {
          "Ref": "AgentCoreGateway"
        },
        "CredentialProviderConfigurations": [
          {
            "CredentialProviderType": "GATEWAY_IAM_ROLE"
          }
        ],
        "TargetConfiguration": {
          "Mcp": {
            "Lambda": {
              "LambdaArn": {
                "Fn::GetAtt": [
                  "ActivityLambdaF78DB3C0",
                  "Arn"
                ]
              },
              "ToolSchema": {
                "InlinePayload": [
                  {
                    "name": "AddActivity",
                    "description": "指定した日のユーザーの行動を追加する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        },
                        "date": {
                          "type": "string",
                          "description": "日付（YYYY-MM-DD）"
                        },
                        "time": {
                          "type": "string",
                          "description": "時刻（HH:MM）"
                        },
                        "activityType": {
                          "type": "string",
                          "description": "活動タイプ（wakeUp|sleep|exercise|meal|snack|weight|bodyFat|mood|medication|other）"
                        },
                        "description": {
                          "type": "string",
                          "description": "活動の説明"
                        },
                        "items": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "活動の詳細項目"
                        }
                      },
                      "required": [
                        "userId",
                        "date",
                        "time",
                        "activityType",
                        "description"
                      ]
                    }
                  },
                  {
                    "name": "UpdateActivity",
                    "description": "指定した日の指定した行動を更新する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        },
                        "date": {
                          "type": "string",
                          "description": "日付（YYYY-MM-DD）"
                        },
                        "time": {
                          "type": "string",
                          "description": "時刻（HH:MM）"
                        },
                        "activityType": {
                          "type": "string",
                          "description": "活動タイプ"
                        },
                        "description": {
                          "type": "string",
                          "description": "活動の説明"
                        },
                        "items": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          },
                          "description": "活動の詳細項目"
                        }
                      },
                      "required": [
                        "userId",
                        "date",
                        "time"
                      ]
                    }
                  },
                  {
                    "name": "DeleteActivity",
                    "description": "指定した日の指定した行動を削除する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        },
                        "date": {
                          "type": "string",
                          "description": "日付（YYYY-MM-DD）"
                        },
                        "time": {
                          "type": "string",
                          "description": "時刻（HH:MM）"
                        }
                      },
                      "required": [
                        "userId",
                        "date",
                        "time"
                      ]
                    }
                  },
                  {
                    "name": "GetActivities",
                    "description": "指定した日のユーザーの行動を取得する",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        },
                        "date": {
                          "type": "string",
                          "description": "日付（YYYY-MM-DD）"
                        }
                      },
                      "required": [
                        "userId",
                        "date"
                      ]
                    }
                  },
                  {
                    "name": "GetActivitiesInRange",
                    "description": "指定した期間のユーザーの行動履歴を取得する（最大365日間）",
                    "inputSchema": {
                      "type": "object",
                      "properties": {
                        "userId": {
                          "type": "string",
                          "description": "ユーザーID"
                        },
                        "startDate": {
                          "type": "string",
                          "description": "開始日（YYYY-MM-DD）"
                        },
                        "endDate": {
                          "type": "string",
                          "description": "終了日（YYYY-MM-DD）"
                        }
                      },
                      "required": [
                        "userId",
                        "startDate",
                        "endDate"
                      ]
                    }
                  }
                ]
              }
            }
          }
        }
      },
      "DependsOn": [
        "AgentCoreGateway"
      ],
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/ActivityManagementGatewayTarget"
      }
    },
    "CDKMetadata": {
      "Type": "AWS::CDK::Metadata",
      "Properties": {
        "Analytics": "v2:deflate64:H4sIAAAAAAAA/+1XbW/bNhD+LdXHQtFQB+gAf3NSNwjmFppfCgxBENDkWWZN8TSSSqoK+u87UqJjNy/bgKFFsXwwRN2Rd8899yJ6lI1OR9mbV+zOnnCxO1FynbULx/guJdFNKxrNShQkXLK1gqs2qZhx0knUv0GTjNuE9JCMk9dJmrim8stF0qXJWioldfEBhRflkz9u8un8Zj79fTVdLGlvhVK7S72UJcyB4y2YZlEBlxvJmbfuTT+yZ6o9DJGMnamB3Bgo8ZapHJXkBCcRYJ3BxoPxGz9GcF36j5FbNO6ni40JcaFwzdSCjGnBTHOpBXxJxpQx6Vcf70OpDH4G7oEs+6Ams1nSXb9Q9PcUXafnGx06oUs5Flo6zNqVBZMjKrLDOMdauwg3GY/ShNUOP4GRm8AXlEyqPf6KWXuHRsQA2qSUega6cNsBiYE/a2ngnSyks/25vXCGd2A4s/CNfNGUa1S0e8OUvRevqupw+7P0WVCbhSz0qjqinBQkvNQTJcmO/SagNKmJir4iBg/1wM19JgKFkbI0Ls6VBO2IwXhgCJ8IBWuXuAP9iSkppGuipnbb9wrvAgheW4flIYp8YPZQtjDVHlgBGgxzQMVgwMVdUjzmCie1zwe5YUqtaTaujGc36DYRgseDRn4N5XtOdX9hmHZ7fwoLrN3BQcuxAjtUJ2ViY8BuH/NeH1H0BJG9ck/nO6Ss6Id0DjXbqz1qEVY5uZdferPHdvudXUrwbdbOsLgwWFdkWA3Lg6Z5upqIYUIX2vpX34o/6HCILMZAMbFyLVjWvq91aHWKCvStNKhL8Jnr8zsoD7xFAMNrSc5pesmv+zlIA4tyvadcRMWWaaHARNA0KOTxfJoeur8Ku14nYTC/APtXwEKmY179OgdTSmvprUslK7N2juE2QyaWmBupuazuC+iq7T+HzNFNaHup6VMGe12M/Hnl83b/T16trUsQZ+HrVsVdk/5DGWd52ONTMuF9s/ZTkfqYG1kdiKK37xXaTws+dIAHlfby0BvxwBK95oGdh2Ih6L+AA99e9gjwQ/GL/f/YUMhgn7wutac3VGfgbDbxD3rPzmq+A3dG97Cr63QNwiDfZXRkQlcb16VzsFgbDnEoPvW7ToNFcl/QhT1UzXCyS/OG7jT6l9PszSh7++qzlfJkmMHZvH/+BaPnD0hADgAA"
      },
      "Metadata": {
        "aws:cdk:path": "Healthspan100Stack/CDKMetadata/Default"
      }
    }
  },
  "Parameters": {
    "BootstrapVersion": {
      "Type": "AWS::SSM::Parameter::Value<String>",
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]"
    }
  }
}
